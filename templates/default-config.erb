<%=
require "json"
require 'active_support'
# Format of data for partial/whole changes:
#  Key is Name/FQDD of Attribute/Component.  If the value is a hash, it is assumed to be a component (and the hash contains the attributes)
# If the value is a string, it is assumed to be an attribute (or if it is a list, it is a list of the attributes that have the same Name, but different values in the same Component)
#
#Format of data for removing changes:
# changes['remove'] is the list of components to remove. The key name corresponds to a component; if the value for that key is an empty list, remove the component corresponding to the key name.  Otherwise, remove the nodes in the list under that key. 
#For example:  {node1: [], node2: ["attr1"=>[]]}.  Component FQDD=node1 will be removed, and Attribute Name=attr1 under Component FQDD=node2 will be removed
#
#
changes = {'partial'=>{}, 'whole'=>{}, 'remove'=> {'attributes'=>{}, 'components'=>{}}}

#
# default settings for all
#
changes['partial']['BIOS.Setup.1-1'] =
    {
        'ProcVirtualization' => 'Enabled',
        'BootMode' => 'Bios'
    }
changes['whole'] = 
    {
        'LifecycleController.Embedded.1' =>
            {
                'LCAttributes.1#CollectSystemInventoryOnRestart' => 'Enabled'
            }
    }

#
# target_boot_device settings
#
if @resource[:target_boot_device] == "HD"
    changes['partial'].deep_merge!(
        {'BIOS.Setup.1-1' =>
            {
                'IntegratedRaid' => 'Enabled',
                'InternalSdCard'  => 'Off',
                'HddSeq'  => 'RAID.Integrated.1-1'
            }
        })
elsif @resource[:target_boot_device] == "SD"
    changes['partial'].deep_merge!(
        {'BIOS.Setup.1-1' =>
            {
                'IntegratedRaid' => 'Disabled',
                'InternalSdCard' => 'On',
                'HddSeq' => 'Disk.SDInternal.1-1',
            }
        })
end

#
# BIOS Settings.  This section should be last, in case the user overrides any configuration that may be set above.
#
@bios_settings.keys.each do |key|
    changes['partial']['BIOS.Setup.1-1'][key] = @bios_settings[key]
end


changes.to_json
%>
